<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.11.1 (455059)"/><meta name="created" content="2017-06-25 11:37:20 +0000"/><meta name="source" content="Clearly"/><meta name="source-url" content="http://www.cnblogs.com/ywsoftware/p/5583167.html"/><meta name="updated" content="2017-06-27 05:17:00 +0000"/><title>BrnShop架构设计</title></head><body><div style="-evernote-webclip: true;"><span style="-evernote-webclip: true;">BrnShop由四个解决方案文件夹所构成，分别是</span><span style="-evernote-webclip: true;">Libraries，Presentation，Strategies和Plugins，下图为方案文件夹的截图和介绍：</span></div><div style="-evernote-webclip: true;">　　</div><div style="-evernote-webclip: true;"><img src="BrnShop%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.resources/181023119733994.png" height="135" width="533"/><br/></div><ul style="-evernote-webclip: true;">
<li>
<div>Libraries：商城基础类库，主要提供系统核心，数据访问，业务逻辑等功能。</div>
</li>
<li>
<div>Presentation：商城web展示，提供网站前台和后台实现。</div>
</li>
<li>
<div>Strategies：包含各种策略程序集</div>
</li>
<li>
<div>Plugins：包含开发授权，支付等插件。</div>
</li>
</ul><p style="-evernote-webclip: true;">　　BrnShop的主要功能都在Libraries和Presentation中，而Strategies和Plugins只是提供程序外围的一些服务。下面依次介绍各个项目：</p><p style="-evernote-webclip: true;">　　<strong>BrnShop.Core项目</strong>：这个项目是BrnShop最核心的项目，它提供商城最底层，最基础的服务。首先通过图片给出各个模块的基本介绍：</p><p style="-evernote-webclip: true;">　　</p><div style="-evernote-webclip: true;"><img src="BrnShop%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.resources/181044133173675.png" height="405" width="759"/><br/></div><ul style="-evernote-webclip: true;">
<li>
<div>对于异步模块，缓存模块，配置模块，数据模块，邮箱模块，随机值模块，Session模块，短信模块这8个模块来说，BrnShop.Core项目只提供加载和接口，并不包含具体实现。下述为邮箱模块代码（其它7个模块的实现原理一样）：</div>
</li>
</ul><div style="-evernote-webclip: true;"><br/></div><div style="-evernote-webclip: true;">1 /// &lt;summary&gt;</div><div style="-evernote-webclip: true;">2 /// BrnShop邮件管理类</div><div style="-evernote-webclip: true;">3 /// &lt;/summary&gt;</div><div style="-evernote-webclip: true;">4 public class BSPEmail</div><div style="-evernote-webclip: true;">5 {</div><div style="-evernote-webclip: true;">6 private static IEmailStrategy _emailstrategy = null;//邮件策略</div><div style="-evernote-webclip: true;">7</div><div style="-evernote-webclip: true;">8 static BSPEmail()</div><div style="-evernote-webclip: true;">9 {</div><div style="-evernote-webclip: true;">10 Load();</div><div style="-evernote-webclip: true;">11 }</div><div style="-evernote-webclip: true;">12</div><div style="-evernote-webclip: true;">13 /// &lt;summary&gt;</div><div style="-evernote-webclip: true;">14 /// 邮件策略实例</div><div style="-evernote-webclip: true;">15 /// &lt;/summary&gt;</div><div style="-evernote-webclip: true;">16 public static IEmailStrategy Instance</div><div style="-evernote-webclip: true;">17 {</div><div style="-evernote-webclip: true;">18 get { return _emailstrategy; }</div><div style="-evernote-webclip: true;">19 }</div><div style="-evernote-webclip: true;">20</div><div style="-evernote-webclip: true;">21 /// &lt;summary&gt;</div><div style="-evernote-webclip: true;">22 /// 加载邮件策略</div><div style="-evernote-webclip: true;">23 /// &lt;/summary&gt;</div><div style="-evernote-webclip: true;">24 private static void Load()</div><div style="-evernote-webclip: true;">25 {</div><div style="-evernote-webclip: true;">26 try</div><div style="-evernote-webclip: true;">27 {</div><div style="-evernote-webclip: true;">28 string[] fileNameList = Directory.GetFiles(System.Web.HttpRuntime.BinDirectory, "BrnShop.EmailStrategy.*.dll", SearchOption.TopDirectoryOnly);</div><div style="-evernote-webclip: true;">29 _emailstrategy = (IEmailStrategy)Activator.CreateInstance(Type.GetType(string.Format("BrnShop.EmailStrategy.{0}.EmailStrategy, BrnShop.EmailStrategy.{0}", fileNameList[0].Substring(fileNameList[0].IndexOf("EmailStrategy.") + 14).Replace(".dll", "")),</div><div style="-evernote-webclip: true;">30 false,</div><div style="-evernote-webclip: true;">31 true));</div><div style="-evernote-webclip: true;">32 }</div><div style="-evernote-webclip: true;">33 catch</div><div style="-evernote-webclip: true;">34 {</div><div style="-evernote-webclip: true;">35 throw new BSPException("创建\"邮件策略对象\"失败，可能存在的原因：未将\"邮件策略程序集\"添加到bin目录中；将多个\"邮件策略程序集\"添加到bin目录中；\"邮件策略程序集\"文件名不符合\"BrnShop.EmailStrategy.{策略名称}.dll\"格式");</div><div style="-evernote-webclip: true;">36 }</div><div style="-evernote-webclip: true;">37 }</div><div style="-evernote-webclip: true;">38</div><div style="-evernote-webclip: true;">39 }</div><div style="-evernote-webclip: true;"><br/></div><p style="-evernote-webclip: true;">　　上述实现的核心思想是“约定大于配置”和“策略模式”。</p><p style="-evernote-webclip: true;">　　目前商城默认实现了每个策略，他们的对应关系及介绍如下：</p><p style="-evernote-webclip: true;">　　</p><div style="-evernote-webclip: true;"><img src="BrnShop%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.resources/181114204268291.png" height="538" width="752"/><br/></div><div style="-evernote-webclip: true;"><br/></div><ul style="-evernote-webclip: true;">
<li>
<div>当前只有企业版提供NOSQL实现，所以目前Data文件夹中的NOSQL为空。</div>
</li>
<li>
<div><br/></div>
</li>
</ul><p style="-evernote-webclip: true;">　　<strong>BrnShop.Data项目</strong>:这个项目主要是通过调用BrnShop.Core项目中的BSPData类来和各种数据存储做交互。</p><p style="-evernote-webclip: true;">　　<strong>BrnShop.Services项目</strong>:商城的业务功能实现</p><p style="-evernote-webclip: true;">　　<strong>BrnShop.Web.Framework项目</strong>:该项目主要提供商城web层面的设计。　　</p><p style="-evernote-webclip: true;"><strong><span>    <span>    </span></span>BrnShop.Web.Admin项目</strong>:商城网站后台，这个项目的类型是类库，不是web项目(但mvc的各部分俱全)，所以不能直接启动。</p><p style="-evernote-webclip: true;"><strong>　　BrnShop.Web项目</strong>:商城网站前台：使用ASP.NET MVC3实现。各个文件夹或文件解释如下：</p><p style="-evernote-webclip: true;">　　</p><div style="-evernote-webclip: true;"><img src="BrnShop%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.resources/181213142076746.png" height="556" width="744"/><br/></div><p style="-evernote-webclip: true;"><br/></p><div><br/></div></body></html>